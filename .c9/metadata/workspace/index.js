{"changed":false,"filter":false,"title":"index.js","tooltip":"/index.js","value":"var express               = require(\"express\"),\n    mongoose              = require(\"mongoose\"),\n    passport              = require(\"passport\"),\n    bodyParser            = require(\"body-parser\"),\n    User                  = require(\"./models/user\"),\n    LocalStrategy         = require(\"passport-local\");\n\nmongoose.connect(\"mongodb://localhost/doodle_db_3\");\nvar app = express();\napp.set('view engine', 'ejs');\napp.use(express.static(\"public\"));\napp.use(bodyParser.urlencoded({extended: true}));\napp.use(require(\"express-session\")({\n    secret : \"Ilyes Houdjedje\",\n    resave: false,\n    saveUninitialized: false\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(new LocalStrategy(User.authenticate()));\npassport.serializeUser(User.serializeUser());\npassport.deserializeUser(User.deserializeUser());\n\n// User.create(\n//     {\n//         username : \"yassou\",\n//         password: \"yassou\",\n//         color: \"red\"\n// }, function(err, user){\n//     if(err){\n//         console.log(err);\n    \n//     }else{\n//         console.log(\"it works!!!!!!!!!!!!!!!!!!!!!!!!!!\");\n//         console.log(user);\n//     }\n// });\n\n\n\napp.get(\"/\", function(req, res){\n    res.render(\"home\");\n});\n\n\n\nfunction isLoggedIn(req, res, next){\n    if(req.isAuthenticated()){\n        return next();\n    }\n    res.redirect(\"/home\");\n}\n\n//show sign up form\napp.get(\"/home\", function(req, res){\n   res.render(\"home\"); \n});\n\n// here i'm using the middleware model     //this is not working, see the .post belo, to solve it https://goo.gl/mon3Z0    https://goo.gl/ytq95m\napp.get(\"/dashboard\",isLoggedIn, function(req, res){\n   res.render(\"dashboard\"); \n});\n\n//handling user sign up\napp.post(\"/register\", function(req, res){\n    User.register(new User({username: req.body.username}), req.body.password, function(err, user){\n        if(err){\n            console.log(err);\n            return res.render('home');\n        }\n        passport.authenticate(\"local\")(req, res, function(){\n        //res.redirect(\"dashboard\", {color: req.body.color });\n        res.render(\"dashboard\", {color: req.body.color });\n        \n        });\n    });\n});\n\n// LOGIN ROUTES\n//render login form\n// app.get(\"/home\", function(req, res){\n//   res.render(\"home\"); \n// });\n//login logic\n//middleware\napp.post(\"/login\", passport.authenticate(\"local\", {\n    successRedirect: \"/dashboard\",\n    failureRedirect: \"/home\"\n}) ,function(req, res){\n});\n\napp.get(\"/logout\", function(req, res){\n    req.logout();\n    res.redirect(\"/\");\n});\n\n\n\n\n\napp.listen(process.env.PORT, process.env.IP, function(){\n    console.log(\"my server has been started...finally!!\");\n})","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":8,"column":20},"end":{"row":8,"column":20},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1491818983228}